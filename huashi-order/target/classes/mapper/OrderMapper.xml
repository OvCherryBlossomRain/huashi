<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.edu.scnu.order.mapper.OrderMapper">
	<select id="getSessions" resultType="HallPojo">
		select * from movie_hall;
	</select>
	
	<select id="getSessionsByMid" parameterType="Integer" resultType="SessionPojo">
		select *
		from session s, movie_hall h where movie_id=#{movieId} and h.hall_id=s.hall_id and s.start_time >= current_timestamp;
	</select>
	
	<select id="getSeats" parameterType="Integer" resultType="SeatPojo">
		select 
			*
		from 
			movie_seat ms, movie_hall mh, session se 
		where 
		    se.session_id=#{sessionID} and
			se.hall_id=mh.hall_id and
		    mh.hall_id=ms.hall_id and
		    ms.seat_id not in (
		    	select 
		    		seat_id
		    	from 
		    		seat_order 
		    	where 
		    		session_id=#{session_id}
		    )
		   
	</select>
	<select id="getSessionTicketMoney" parameterType="Integer" resultType="SessionPojo">
		select *
		from session where session_id=#{sessionId};
	</select>
	
	<insert id="insertSeatOrder" parameterType="SeatOrder">
		insert into seat_order(seat_id,order_id,session_id)
		values(#{seatId},#{orderId},#{sessionId});
	</insert>
	
	<select id="getMaxOrder" resultType="Order">
		select * from orders 
		order by order_id desc limit 1;
	</select>
	
	<select id="getSessionsBySid" resultType="SessionPojo">
		select * from session where
		session_id=#{sessionID};
	</select>
	<insert id="addNewOrder" parameterType="Order">
		insert into orders(order_id,buy_time,money,hall_id,movie_id,customer_id)
		values(#{orderId},#{buyTime},#{money},#{hallId},#{movieId},#{customerId});
	</insert>
	
	
	
	
	<select id="getOrders"  parameterType="Integer" resultType="Order">
		select * from orders where customer_id=#{customerId};
	</select>
	
	<select id="getSeatId" parameterType="Integer" resultType="Integer">
		select seat_id from seat_order where order_id=#{orderId};
	</select>
	
	<select id="getSessionId" parameterType="Integer" resultType="Integer">
		select distinct session_id from seat_order where order_id=#{orderId};
	</select>
	
	<select id="getMovieDes" parameterType="Integer" resultType="String">
		select  description from movie_hall where hall_id=#{hallId};
	</select>
	
	<select id="getMovieName" parameterType="Integer" resultType="String">
		select movie_name from movie where movie_id=#{movieId};
	</select>
	
	<select id="getSeatsInfo" parameterType="Integer" resultType="SeatPojo">
		select * from movie_seat where seat_id=#{seatId};
	</select>
	
	<delete id="delOrder" parameterType="Integer">
		delete from orders where order_id=#{orderId};
	</delete>
	
	<delete id="delOrderandseat" parameterType="Integer">
		delete from seat_order where order_id=#{orderId};
	</delete>
	
</mapper>






